{% extends "layout/base.html" %} {% block main %}

<div class="container">
  <header class="text-center">
    <h3 class="h3 pt-4">{{heading}}</h3>
  </header>
  <hr class="my-2" />
  <div class="fliud-container font-monospace">
    <div class="row g-5 py-4">
      <div class="col-md-4 col-sm-12">
        <div class="card h-100">
          <h4 class="card-header">
            Instance: <span id="name" class="fw-bold">{{instance.name}}</span>
          </h4>
          <div class="card-body">
            <h5 class="card-title mb-3">
              Project:
              <span id="project_name" class="fw-bold">
                {{instance.project_name}}
              </span>
              <a
                href="{{instance.github_url}}"
                class="card-link fs-6"
                target="_blank"
              >
                Github
              </a>
            </h5>
            <p class="card-text">
              Instance ID:
              <span id="instance_id" class="fw-bold">
                {{instance.instance_id}}
              </span>
            </p>

            <p class="card-text">
              Domain:
              <span id="domain" class="fw-bold">
                {% if instance.domain %}
                <a href="http://{{instance.domain}}" target="_blank">
                  {{instance.domain}}
                </a>
                {% endif %}
              </span>
            </p>
            <p class="card-text">
              Create Date:
              <span id="created_date" class="fw-bold">
                {{instance.created_date|date:"Y-m-d H:i:s " }}
              </span>
            </p>
            <p class="card-text">
              Pulic IP:
              <span id="public_ip" class="fw-bold">
                <!-- public ip -->
              </span>
            </p>
            <p class="card-text">
              Status:
              <span id="status" class="fw-bold">
                <!-- status -->
              </span>
            </p>
            <p>
              <button
                id="btn_update_state"
                type="button"
                class="btn btn-sm btn-outline-primary rounded-pill align-middle my-2"
              >
                <i class="bi bi-arrow-clockwise"></i>
                Refresh Instance State
              </button>
              <button
                id="btn_update_code"
                type="button"
                class="btn btn-sm btn-outline-success rounded-pill align-middle my-2"
              >
                <i class="bi bi-cloud-upload"></i>
                Update Github Code
              </button>
            </p>
            <!-- <a
              id="btn_stop"
              href="#"
              class="btn btn-sm btn-outline-warning rounded-pill me-2"
              stop_ec2_by_name
            >
              Stop Instance
            </a> -->
            <hr class="py-2" />
            <div class="d-flex">
              <a
                href="{% url 'AppEC2:list' %}"
                class="btn btn-sm btn-outline-secondary rounded-pill me-auto"
              >
                Back
              </a>

              <a
                href="{% url 'AppEC2:terminate' instance.pk %}"
                class="btn btn-sm btn-outline-danger rounded-pill"
              >
                Terminate Instance
              </a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8 col-sm-12">
        <div class="card h-100 rounded">
          <div
            class="card-text h-100 text-bg-dark p-2 rounded-top-2"
            style="min-height: 200px"
          ></div>
          <div class="input-group">
            <input
              type="text"
              class="form-control"
              placeholder="Linux Command"
              aria-label="Recipient's username"
              aria-describedby="button-addon2"
            />
            <button
              class="btn btn-outline-secondary"
              type="button"
              id="button-addon2"
            >
              Input
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% load static %}
<script src="{% static 'js/ec2_main.js' %}"></script>
<script>
  const INFO_URL = "/ec2/info";
  const UPDATE_CODE_URL = "/ec2/code";
  const INSTANCE_NAME = "{{instance.name|safe}}";

  // load instance info when document is ready.
  $(function () {
    request_ec2_by_name(INSTANCE_NAME, INFO_URL).then((data) => display(data));
  });

  // load instance info when refresh button is clicked.
  $("#btn_update_state").click(() => {
    request_ec2_by_name(INSTANCE_NAME, INFO_URL).then((data) => display(data));
  });

  // update codes from github after deployed.
  $("#btn_update_code").click(() => {
    request_ec2_by_name(INSTANCE_NAME, UPDATE_CODE_URL).then((data) =>
      console.log(data)
    );
  });
</script>
{% endblock %}
